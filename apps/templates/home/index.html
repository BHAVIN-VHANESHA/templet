{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <!-- [ Main Content ] start -->


    <div class="pcoded-main-container">
        <div class="pcoded-content">
            <!-- [ Main Content ] start -->
            <div class="row">
                <!-- order-card start -->
                <div class="col-md-6 col-xl-3">
                    <div class="card bg-c-blue order-card">
                        <div class="card-body">
                            <h6 class="text-white">Orders Received</h6>
                            <h2 class="text-end text-white"><i class="feather icon-shopping-cart float-start"></i><span>{{ data["order_result"] }}</span></h2>
                            <p class="m-b-0">Completed Orders<span class="float-end">{{ data["order_result"] }}</span></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="card bg-c-green order-card">
                        <div class="card-body">
                            <h6 class="text-white">Total Sales</h6>
                            <h2 class="text-end text-white"><i class="feather icon-tag float-start"></i><span>{{ data["total_sales_result"] }}</span>
                            </h2>
                            <p class="m-b-0">This Month<span class="float-end">{{ data["current_month_result"] }}</span></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="card bg-c-yellow order-card">
                        <div class="card-body">
                            <h6 class="text-white">Revenue</h6>
                            <h2 class="text-end text-white"><i
                                    class="feather icon-repeat float-start"></i><span>₹{{ data["revenue_result"] }}</span></h2>
                            <p class="m-b-0">This Month<span class="float-end">₹{{ data["current_month_revenue"] }}</span></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="card bg-c-red order-card">
                        <div class="card-body">
                            <h6 class="text-white">Total Customers</h6>
                            <h2 class="text-end text-white"><i
                                    class="feather icon-users float-start"></i><span>{{ data["total_customers"] }}</span></h2>
                            <p class="m-b-0">This Month<span class="float-end">{{ data["new_customers_current_month"] }}</span></p>
                        </div>
                    </div>
                </div>
                <!-- order-card end -->
                <!-- users visite start -->
                <div class="col-md-12 col-xl-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Monthly Orders</h5>
                        </div>
                        <div class="card-body ps-0 pb-0">
                            <div id="unique-visitor-chart"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Top-5 Buyer's</h5>
<!--                            <span class="d-block m-t-5">use class <code>table-hover</code> inside table element</span>-->
                        </div>
                        <div class="card-body table-border-style">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>S.No.</th>
                                            <th>Buyer Name</th>
                                            <th>Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    {% for index, row in top_5_data.iterrows() %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ row['Buyer_Name'] }}</td>
                                        <td>{{ row['Amount'] }}</td>
                                    </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
<!--                <div class="col-md-12 col-xl-6">-->
<!--                    <div class="row">-->
<!--                        <div class="col-sm-6">-->
<!--                            <div class="card">-->
<!--                                <div class="card-body bg-patern">-->
<!--                                    <div class="row">-->
<!--                                        <div class="col-auto">-->
<!--                                            <span>Customers</span>-->
<!--                                        </div>-->
<!--                                        <div class="col text-end">-->
<!--                                            <h2 class="mb-0">826</h2>-->
<!--                                            <span class="text-c-green">8.2%<i class="feather icon-trending-up ms-1"></i></span>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div id="customer-chart"></div>-->
<!--                                    <div class="row mt-3">-->
<!--                                        <div class="col">-->
<!--                                            <h3 class="m-0"><i class="fas fa-circle f-10 m-r-5 text-success"></i>674</h3>-->
<!--                                            <span class="ms-3">New</span>-->
<!--                                        </div>-->
<!--                                        <div class="col">-->
<!--                                            <h3 class="m-0"><i class="fas fa-circle text-primary f-10 m-r-5"></i>182</h3>-->
<!--                                            <span class="ms-3">Return</span>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="col-sm-6">-->
<!--                            <div class="card bg-primary text-white">-->
<!--                                <div class="card-body bg-patern-white">-->
<!--                                    <div class="row">-->
<!--                                        <div class="col-auto">-->
<!--                                            <span>Customers</span>-->
<!--                                        </div>-->
<!--                                        <div class="col text-end">-->
<!--                                            <h2 class="mb-0 text-white">826</h2>-->
<!--                                            <span class="text-white">8.2%<i class="feather icon-trending-up ms-1"></i></span>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                    <div id="customer-chart1"></div>-->
<!--                                    <div class="row mt-3">-->
<!--                                        <div class="col">-->
<!--                                            <h3 class="m-0 text-white"><i class="fas fa-circle f-10 m-r-5 text-success"></i>674</h3>-->
<!--                                            <span class="ms-3">New</span>-->
<!--                                        </div>-->
<!--                                        <div class="col">-->
<!--                                            <h3 class="m-0 text-white"><i class="fas fa-circle f-10 m-r-5 text-white"></i>182</h3>-->
<!--                                            <span class="ms-3">Return</span>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <!-- users visite end -->


                <!-- social statustic start -->
<!--                <div class="col-md-12 col-lg-4">-->
<!--                    <div class="card seo-card overflow-hidden">-->
<!--                        <div class="card-body seo-statustic">-->
<!--                            <i class="feather icon-save f-20 text-c-red"></i>-->
<!--                            <h5 class="mb-1">65%</h5>-->
<!--                            <p>Memory</p>-->
<!--                        </div>-->
<!--                        <div class="seo-chart">-->
<!--                            <div id="seo-card1"></div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="col-md-6 col-lg-4">-->
<!--                    <div class="card">-->
<!--                        <div class="card-body text-center">-->
<!--                            <i class="fa fa-envelope-open text-c-blue d-block f-40"></i>-->
<!--                            <h4 class="m-t-20"><span class="text-c-blue">8.62k</span> Subscribers</h4>-->
<!--                            <p class="m-b-20">Your main list is growing</p>-->
<!--                            <button class="btn btn-primary btn-sm btn-round">Manage List</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="col-md-6 col-lg-4">-->
<!--                    <div class="card">-->
<!--                        <div class="card-body text-center">-->
<!--                            <i class="fab fa-twitter text-c-green d-block f-40"></i>-->
<!--                            <h4 class="m-t-20"><span class="text-c-blgreenue">+40</span> Followers</h4>-->
<!--                            <p class="m-b-20">Your main list is growing</p>-->
<!--                            <button class="btn btn-success btn-sm btn-round">Check them out</button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <!-- social statustic end -->
                <!-- account-section start -->
<!--                <div class="col-lg-4 col-md-12">-->
<!--                    <div class="card overflow-hidden">-->
<!--                        <div class="card-body">-->
<!--                            <h6>Conversions</h6>-->
<!--                            <h4 class="m-0">0.85%<span class="text-c-blue ms-2"><i class="feather icon-arrow-up"></i>0.50%</span></h4>-->
<!--                            <span>Purchased</span>-->
<!--                        </div>-->
<!--                        <div id="coversions-chart1"></div>-->
<!--                    </div>-->
<!--                    <div class="card overflow-hidden">-->
<!--                        <div class="card-body">-->
<!--                            <h6>Conversions</h6>-->
<!--                            <h4 class="m-0">0.85%<span class="text-c-green ms-2"><i class="feather icon-arrow-up"></i>0.50%</span></h4>-->
<!--                            <span>Purchased</span>-->
<!--                        </div>-->
<!--                        <div id="coversions-chart2"></div>-->
<!--                    </div>-->
<!--                    <div class="card overflow-hidden">-->
<!--                        <div class="card-body">-->
<!--                            <h6>Conversions</h6>-->
<!--                            <h4 class="m-0">0.85%<span class="text-c-red ms-2"><i class="feather icon-arrow-up"></i>0.50%</span></h4>-->
<!--                            <span>Purchased</span>-->
<!--                        </div>-->
<!--                        <div id="coversions-chart4"></div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="col-lg-8 col-md-12">-->
<!--                    <div class="card">-->
<!--                        <div class="card-header">-->
<!--                            <h5>Activity Feed</h5>-->
<!--                            <div class="card-header-right">-->
<!--                                <div class="btn-group card-option">-->
<!--                                    <button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
<!--                                        <i class="feather icon-more-horizontal"></i>-->
<!--                                    </button>-->
<!--                                    <ul class="list-unstyled card-option dropdown-menu dropdown-menu-end">-->
<!--                                        <li class="dropdown-item full-card"><a href="#"><span><i class="feather icon-maximize"></i> maximize</span><span style="display:none"><i class="feather icon-minimize"></i> Restore</span></a></li>-->
<!--                                        <li class="dropdown-item minimize-card"><a href="#"><span><i class="feather icon-minus"></i> collapse</span><span style="display:none"><i class="feather icon-plus"></i> expand</span></a></li>-->
<!--                                        <li class="dropdown-item reload-card"><a href="#"><i class="feather icon-refresh-cw"></i> reload</a></li>-->
<!--                                        <li class="dropdown-item close-card"><a href="#"><i class="feather icon-trash"></i> remove</a></li>-->
<!--                                    </ul>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                        <div class="card-body">-->
<!--                            <ul class="feed-blog ps-0">-->
<!--                                <li class="active-feed">-->
<!--                                    <div class="feed-user-img">-->
<!--                                        <img src="/static/assets/images/user/avatar-4.jpg" class="img-radius " alt="User-Profile-Image">-->
<!--                                    </div>-->
<!--                                    <h6><span class="badge bg-danger">File</span> Eddie uploaded new files: <small class="text-muted">2 hours ago</small></h6>-->
<!--                                    <p class="m-b-15 m-t-15">hii <b> @everone</b> Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s.</p>-->
<!--                                    <div class="row">-->
<!--                                        <div class="col-auto text-center">-->
<!--                                            <img src="/static/assets/images/gallery-grid/img-grd-gal-1.jpg" alt="img" class="img-fluid wid-100">-->
<!--                                            <h6 class="m-t-15 m-b-0">Old Scooter</h6>-->
<!--                                            <p class="text-muted m-b-0"><small>PNG-100KB</small></p>-->
<!--                                        </div>-->
<!--                                        <div class="col-auto text-center">-->
<!--                                            <img src="/static/assets/images/gallery-grid/img-grd-gal-2.jpg" alt="img" class="img-fluid wid-100">-->
<!--                                            <h6 class="m-t-15 m-b-0">Wall Art</h6>-->
<!--                                            <p class="text-muted m-b-0"><small>PNG-150KB</small></p>-->
<!--                                        </div>-->
<!--                                        <div class="col-auto text-center">-->
<!--                                            <img src="/static/assets/images/gallery-grid/img-grd-gal-3.jpg" alt="img" class="img-fluid wid-100">-->
<!--                                            <h6 class="m-t-15 m-b-0">Microphone</h6>-->
<!--                                            <p class="text-muted m-b-0"><small>PNG-150KB</small></p>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </li>-->
<!--                                <li class="diactive-feed">-->
<!--                                    <div class="feed-user-img">-->
<!--                                        <img src="/static/assets/images/user/avatar-4.jpg" class="img-radius " alt="User-Profile-Image">-->
<!--                                    </div>-->
<!--                                    <h6><span class="badge bg-success">Task</span> Sarah marked the Pending Review: <span class="text-c-green"> Trash Can Icon Design</span><small class="text-muted"> 2 hours ago</small></h6>-->
<!--                                </li>-->
<!--                                <li class="diactive-feed">-->
<!--                                    <div class="feed-user-img">-->
<!--                                        <img src="/static/assets/images/user/avatar-4.jpg" class="img-radius " alt="User-Profile-Image">-->
<!--                                    </div>-->
<!--                                    <h6><span class="badge bg-primary">comment</span> abc posted a task: <span class="text-c-green">Design a new Homepage</span> <small class="text-muted">6 hours ago</small></h6>-->
<!--                                    <p class="m-b-15 m-t-15">hii <b> @everone</b> Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s.</p>-->
<!--                                </li>-->
<!--                            </ul>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
                <!-- account-section end -->
                <!-- Customer overview start -->
                <div class="col-md-12">
                    <div class="card table-card">
                        <div class="card-header">
                            <h5>Sales Monitor</h5>
                            <div class="card-header-right">
                                <input type="text" id="searchBar" style="width:480px" class="form-control" placeholder="Search by name or date range (dd-mm-yyyy to dd-mm-yyyy)">
                                <!--                                <div class="btn-group card-option">-->
<!--                                    <button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">-->
<!--                                        <i class="feather icon-more-horizontal"></i>-->
<!--                                    </button>-->
<!--                                    <ul class="list-unstyled card-option dropdown-menu dropdown-menu-end">-->
<!--                                        <li class="dropdown-item full-card"><a href="#"><span><i class="feather icon-maximize"></i> maximize</span><span style="display:none"><i class="feather icon-minimize"></i> Restore</span></a></li>-->
<!--                                        <li class="dropdown-item minimize-card"><a href="#"><span><i class="feather icon-minus"></i> collapse</span><span style="display:none"><i class="feather icon-plus"></i> expand</span></a></li>-->
<!--                                        <li class="dropdown-item reload-card"><a href="#"><i class="feather icon-refresh-cw"></i> reload</a></li>-->
<!--                                        <li class="dropdown-item close-card"><a href="#"><i class="feather icon-trash"></i> remove</a></li>-->
<!--                                    </ul>-->
<!--                                </div>-->
                            </div>
<!--                            <ul class="nav nav-pills nav-fill mt-3 border-bottom pb-3" id="pills-tab" role="tablist">-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true"><i class="feather icon-layers m-r-5"></i> BLOCK & TILES ADHESIVE</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false"><i class="feather icon-codepen m-r-5"></i> EPOXY & SBR</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" href="#pills-contact" role="tab" aria-controls="pills-contact" aria-selected="false"><i class="feather icon-grid m-r-5"></i> OTHERS</a>-->
<!--                                </li>-->
<!--                                <li class="nav-item">-->
<!--                                    <a class="nav-link" id="pills-news-tab" data-bs-toggle="pill" href="#pills-news" role="tab" aria-controls="pills-news" aria-selected="false"><i class="feather icon-repeat m-r-5"></i> Revenue</a>-->
<!--                                </li>-->
<!--                            </ul>-->
                        </div>
                        <div class="card-body p-0">
    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
            <div class="table-responsive">
                <!-- Search bar -->

                <div class="customer-scroll" style="height:362px;position:relative;">
                    <table class="table table-hover m-b-0" id="myTable">
                        <thead class="table-fixed-header">
                            <tr>
                                <th>Product Name</th>
                                <th>HSN Code</th>
                                <th>Qty</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>Bill No</th>
                                <th>Bill Date</th>
                                <th>Buyer Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in data_df %}
                            <tr>
                                <td>{{ item.Product_Name }}</td>
                                <td>{{ item.HSN_Code }}</td>
                                <td>{{ item.Qty }}</td>
                                <td>{{ item.Rate }}</td>
                                <td>{{ item.Amount }}</td>
                                <td>{{ item.Bill_No }}</td>
                                <td>{{ item.Bill_Date }}</td>
                                <td>{{ item.Buyer_Name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
                    </div>
                </div>
                <!-- Customer overview end -->
            </div>
            <!-- [ Main Content ] end -->
        </div>
    </div>
    <!-- [ Main Content ] end -->

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<!--table search-->
<script>
    // Function to filter table rows based on input and date range
    function filterTable() {
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("searchBar");
        filter = input.value.toUpperCase();
        table = document.getElementById("myTable");
        var tbody = table.getElementsByTagName("tbody")[0]; // Get the tbody element
        tr = tbody.getElementsByTagName("tr"); // Get all rows within tbody
        var startDate, endDate;

        // Check if filter contains a date range
        if (filter.includes(" TO ")) {
            var dateRange = filter.split(" TO ");
            startDate = parseDate(dateRange[0].trim());
            endDate = parseDate(dateRange[1].trim());
        }

        for (i = 0; i < tr.length; i++) {
            var showRow = false;
            td = tr[i].getElementsByTagName("td");
            for (var j = 0; j < td.length; j++) {
                var cell = td[j];
                if (cell) {
                    txtValue = cell.textContent || cell.innerText;
                    // Check if cell content matches the search filter or falls within the date range
                    if ((txtValue.toUpperCase().indexOf(filter) > -1) ||
                        (startDate && endDate && isDateWithinRange(cell.textContent.trim(), startDate, endDate))) {
                        showRow = true;
                        break;
                    }
                }
            }
            // Toggle row display based on filtering results
            tr[i].style.display = showRow ? "" : "none";
        }
    }

    // Add event listener to the search bar
    document.getElementById("searchBar").addEventListener("keyup", filterTable);

    // Function to parse dd-mm-yyyy date format
    function parseDate(dateString) {
        var parts = dateString.split("-");
        // Ensure proper parsing of date parts and return a Date object
        return new Date(parseInt(parts[2], 10), parseInt(parts[1], 10) - 1, parseInt(parts[0], 10));
    }

    // Function to check if a date falls within a specified range
    function isDateWithinRange(dateString, startDate, endDate) {
        var date = parseDate(dateString);
        // Adjust endDate to include the entire day by setting it to the end of the day
        endDate.setHours(23, 59, 59, 999);
        return (date >= startDate && date <= endDate);
    }
</script>


    <!-- Add Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybB5IXNxFwWQfE7u8Lj+XJHAxKlXiG/8rsrtpb6PEdzD828Ii" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/" crossorigin="anonymous"></script>

    <!-- Add custom JS -->
    <script>
        $(document).ready(function() {
            // Fetch the table data from the Flask app
            $.getJSON('{{ table_data }}', function(data) {
                // Iterate through the data and append rows to the table
                $.each(data, function(index, value) {
                    $('#buyer-table tbody').append('<tr><td>' + value.Buyer_Name + '</td><td>' + value.Amount + '</td></tr>');
                });
            });
        });
    </script>

    <script src="/static/assets/js/plugins/apexcharts.min.js"></script>
<!--    <script src="https://cdn.jsdelivr.net/npm/apexcharts/dist/apexcharts.min.js"></script>-->
    <script src="/static/assets/js/pages/dashboard-main.js"></script>


<!--apex chart-->
<script>
    const dict = {{apex_data | safe}}
        var options = {
            chart: {
                height: 350,
                type: 'line',
                toolbar: {
                    show: false,
                },
            },
            dataLabels: {
                enabled: false
            },
            stroke: {
                width: 2,
                curve: 'smooth'
            },
            series: [{
                name: 'Orders Count',
                data: dict.orders_count
            },
            {
                name: 'Monthly Revenue',
                data: dict.revenue_monthly
            }
            ],
            legend: {
                position: 'top',
            },
            xaxis: {
                type: 'datetime',
                categories: dict.months_years,
                axisBorder: {
                    show: false,
                },
                label: {
<!--                    format: 'MM-yyyy',-->
                    style: {
                        color: '#ccc'
                    },
                },
            },
            yaxis:
                {
                show: true,
<!--                min: 0,-->
<!--                max: 40000000,-->
                labels: {
                    style: {
                        color: '#ccc'
                    }
                }
            },
            colors: ['#73b4ff', '#59e0c5'],
            fill: {
                type: 'gradient',
                gradient: {
                    shade: 'light',
                    gradientToColors: ['#4099ff', '#2ed8b6'],
                    shadeIntensity: 0.5,
                    type: 'horizontal',
                    opacityFrom: 1,
                    opacityTo: 1,
                    stops: [0, 100]
                },
            },
            markers: {
                size: 5,
                colors: ['#4099ff', '#2ed8b6'],
                opacity: 0.9,
                strokeWidth: 2,
                hover: {
                    size: 7,
                }
            },
            grid: {
                borderColor: '#cccccc3b',
            }
        };
        var chart = new ApexCharts(document.querySelector("#unique-visitor-chart"), options);
        chart.render();
</script>

{% endblock javascripts %}
